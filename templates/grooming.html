<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nearby Grooming Services | FurrEver</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

<!-- Leaflet -->
<link rel="stylesheet"
 href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{
    margin:0;
    font-family:'Poppins', sans-serif;
    background:#f9f9f9;
}

/* NAVBAR */
.navbar{
    background:white;
    padding:15px 50px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 2px 10px rgba(0,0,0,0.08);
}

.logo{
    font-size:22px;
    font-weight:600;
    color:#ff7a00;
}

.back{
    text-decoration:none;
    color:#ff7a00;
    font-weight:500;
}

/* CONTENT */
.container{
    max-width:1100px;
    margin:40px auto;
    padding:20px;
}

h1{
    text-align:center;
    margin-bottom:20px;
}

.search{
    text-align:center;
    margin-bottom:15px;
}

#searchBox{
    width:260px;
    padding:10px;
    border-radius:8px;
    border:1px solid #ccc;
}

.search button{
    padding:10px 16px;
    border:none;
    background:#ff7a00;
    color:white;
    border-radius:8px;
    cursor:pointer;
}

/* MAP */
#map{
    height:500px;
    width:100%;
    border-radius:16px;
    box-shadow:0 6px 18px rgba(0,0,0,0.08);
}


/* POPUP CARD DESIGN */
.popup-card{
    font-family:'Poppins', sans-serif;
    width:240px;
}

.popup-header{
    font-size:16px;
    font-weight:600;
    color:#ff7a00;
    margin-bottom:8px;
}

.popup-body p{
    font-size:13px;
    margin:6px 0;
    color:#444;
}

.popup-footer{
    margin-top:10px;
    text-align:center;
}

.popup-footer button{
    background:#ff7a00;
    color:white;
    border:none;
    padding:6px 12px;
    border-radius:8px;
    cursor:pointer;
    font-size:12px;
}

.popup-footer button:hover{
    background:#e66a00;
}

/* Smooth popup edges */
.leaflet-popup-content-wrapper{
    border-radius:14px;
}


</style>
</head>

<body>

<!-- NAV -->
<div class="navbar">
    <div class="logo">FurrEver üêæ</div>
    <a class="back" href="/">‚Üê Back to Home</a>
</div>

<div class="container">

    <h1>Nearby Grooming Services</h1>

    <!-- SEARCH -->
    <div class="search">
        <input type="text" id="searchBox"
         placeholder="Search city / place">
         <!--p id="status" style="text-align:center;color:#777;"></p>-->
         <p id="status"
   style="text-align:center;
          font-weight:500;
          margin-top:10px;">
</p>


        <button onclick="searchLocation()">Search</button>
    </div>

    <!-- MAP -->
    <div id="map"></div>

</div>

<script>
var map = L.map('map').setView([9.9312,76.2673],13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
.addTo(map);

var serviceMarkers=[];


function searchLocation(){

 let city = document.getElementById("searchBox").value.trim();

 if(!city){
   alert("Please enter a city");
   return;
 }

 loadNearbyServices(city);
}

function loadNearbyServices(place = "") {

    document.getElementById("status").innerText =
        "Loading grooming centers...";

    // Remove old markers
    serviceMarkers.forEach(m => map.removeLayer(m));
    serviceMarkers = [];

    fetch(`/get-grooming-data?place=${place}`)
    .then(res => res.json())
    .then(data => {

        if (!data.grooming || data.grooming.length === 0) {
            document.getElementById("status").innerText =
                "‚ùå No grooming centers found for this location.";
            return;
        }

        /*document.getElementById("status").innerText =
            `‚úÖ ${data.grooming.length} grooming center(s) found`;*/

        data.grooming.forEach(p => {

            let cardHTML = `
                <div class="popup-card">

                    <div class="popup-header">
                        üêæ ${p.name}
                    </div>

                    <div class="popup-body">
                        <p><strong>üìç Address:</strong><br>${p.address}</p>

                        ${p.phone ? 
                            `<p><strong>üìû Phone:</strong> ${p.phone}</p>` 
                            : ""}

                        ${p.services ? 
                            `<p><strong>‚úÇ Services:</strong> ${p.services}</p>` 
                            : ""}
                    </div>

                    <div class="popup-footer">
                        <button onclick="navigateToShop('${p.name}', '${p.address}')">
                            Get Directions
                        </button>
                    </div>

                </div>
            `;

            let marker = L.marker([p.latitude, p.longitude])
                .addTo(map)
                .bindPopup(cardHTML);

            serviceMarkers.push(marker);

                // ‚úÖ AUTO-REDIRECT MAP TO PINS
const validPoints = data.grooming.filter(p =>
    !isNaN(p.latitude) && !isNaN(p.longitude)
);

if (validPoints.length > 0) {
    const bounds = L.latLngBounds(
        validPoints.map(p => [p.latitude, p.longitude])
    );

    setTimeout(() => {
        map.invalidateSize();
        map.fitBounds(bounds, { padding: [50, 50] });
    }, 200);
}


        });

    })
    .catch(error => {
        console.error("Error loading grooming centers:", error);
        document.getElementById("status").innerText =
            "‚ö†Ô∏è Error loading grooming centers.";
    });
}




function navigateToShop(shopName, address = "") {
    const query = `${shopName} ${address}`.trim();
    const url =
      `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;
    window.open(url, "_blank");
}


</script>







</body>
</html>